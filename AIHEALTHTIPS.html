<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Health Guide AI - Full Page</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    
    <style>
        /* --- Custom Scrollbar for Chat --- */
        .custom-scrollbar::-webkit-scrollbar {
            width: 6px;
        }
        .custom-scrollbar::-webkit-scrollbar-track {
            background: transparent;
        }
        .custom-scrollbar::-webkit-scrollbar-thumb {
            background-color: rgba(16, 185, 129, 0.2);
            border-radius: 20px;
        }
        .custom-scrollbar::-webkit-scrollbar-thumb:hover {
            background-color: rgba(16, 185, 129, 0.5);
        }

        /* --- Animations --- */
        .message-enter { animation: slideUp 0.3s ease-out forwards; }
        @keyframes slideUp { 
            from { opacity: 0; transform: translateY(10px); } 
            to { opacity: 1; transform: translateY(0); } 
        }

        .typing-dot { animation: bounce 1.4s infinite ease-in-out both; }
        .typing-dot:nth-child(1) { animation-delay: -0.32s; }
        .typing-dot:nth-child(2) { animation-delay: -0.16s; }
        @keyframes bounce { 0%, 80%, 100% { transform: scale(0); } 40% { transform: scale(1); } }
    </style>
</head>
<body class="bg-gray-50 font-sans h-screen flex overflow-hidden">

    <!-- ================= SIDEBAR ================= -->
    <aside class="w-64 bg-emerald-900 text-white flex-col hidden md:flex shadow-xl z-20">
        <!-- Logo Area -->
        <div class="p-6 border-b border-emerald-800 flex items-center gap-3">
            <div class="w-10 h-10 bg-emerald-500 rounded-lg flex items-center justify-center shadow-lg">
                <i class="fa-solid fa-heart-pulse text-xl text-white"></i>
            </div>
            <div>
                <h1 class="font-bold text-lg tracking-wide">Health<span class="text-emerald-400">AI</span></h1>
                <p class="text-xs text-emerald-300">Wellness Assistant</p>
            </div>
        </div>

        <!-- Navigation / Tools -->
        <nav class="flex-1 p-4 space-y-2 overflow-y-auto">
            <div class="text-xs font-semibold text-emerald-400 uppercase tracking-wider mb-2 pl-2">Quick Tools</div>
            
            <button onclick="sendQuickAction('Generate a 15-minute home workout routine with no equipment.')" class="w-full flex items-center gap-3 px-4 py-3 rounded-lg hover:bg-emerald-800 transition-colors text-left group">
                <i class="fa-solid fa-person-running text-emerald-400 group-hover:text-white transition-colors"></i>
                <span class="text-sm font-medium text-gray-200 group-hover:text-white">Quick Workout</span>
            </button>
            
            <button onclick="sendQuickAction('Suggest a healthy, easy dinner recipe under 30 mins.')" class="w-full flex items-center gap-3 px-4 py-3 rounded-lg hover:bg-emerald-800 transition-colors text-left group">
                <i class="fa-solid fa-carrot text-orange-400 group-hover:text-white transition-colors"></i>
                <span class="text-sm font-medium text-gray-200 group-hover:text-white">Healthy Recipe</span>
            </button>
            
            <button onclick="sendQuickAction('Give me a 2-minute mindfulness breathing exercise.')" class="w-full flex items-center gap-3 px-4 py-3 rounded-lg hover:bg-emerald-800 transition-colors text-left group">
                <i class="fa-solid fa-leaf text-green-400 group-hover:text-white transition-colors"></i>
                <span class="text-sm font-medium text-gray-200 group-hover:text-white">De-Stress Now</span>
            </button>
            
            <div class="text-xs font-semibold text-emerald-400 uppercase tracking-wider mt-6 mb-2 pl-2">Topics</div>
            <div class="space-y-1">
                <button onclick="sendQuickAction('What are the best foods for energy?')" class="w-full text-left px-4 py-2 text-sm text-emerald-200 hover:text-white hover:bg-emerald-800/50 rounded">‚ö° Energy Boosting</button>
                <button onclick="sendQuickAction('How can I improve my sleep quality?')" class="w-full text-left px-4 py-2 text-sm text-emerald-200 hover:text-white hover:bg-emerald-800/50 rounded">üò¥ Sleep Hygiene</button>
                <button onclick="sendQuickAction('Explain macronutrients simply.')" class="w-full text-left px-4 py-2 text-sm text-emerald-200 hover:text-white hover:bg-emerald-800/50 rounded">üçé Nutrition 101</button>
            </div>
        </nav>

        <!-- Footer -->
        <div class="p-4 border-t border-emerald-800 text-xs text-emerald-400 text-center">
            <p>Powered by Gemini AI</p>
            <p class="opacity-60 mt-1">Not medical advice.</p>
        </div>
    </aside>

    <!-- ================= MAIN CONTENT ================= -->
    <main class="flex-1 flex flex-col h-full relative">
        
        <!-- Header -->
        <header class="h-16 bg-white border-b border-gray-200 flex items-center justify-between px-6 shadow-sm z-10">
            <div class="flex items-center gap-3 md:hidden">
                <div class="w-8 h-8 bg-emerald-500 rounded flex items-center justify-center text-white">
                    <i class="fa-solid fa-heart-pulse"></i>
                </div>
                <span class="font-bold text-gray-800">HealthAI</span>
            </div>
            
            <div class="hidden md:block">
                <h2 class="text-lg font-semibold text-gray-800">Chat Session</h2>
            </div>

            <div class="flex items-center gap-2">
                <span class="flex h-2.5 w-2.5 relative">
                    <span class="animate-ping absolute inline-flex h-full w-full rounded-full bg-emerald-400 opacity-75"></span>
                    <span class="relative inline-flex rounded-full h-2.5 w-2.5 bg-emerald-500"></span>
                </span>
                <span class="text-sm text-gray-500 font-medium">AI Active</span>
            </div>
        </header>

        <!-- Chat Area -->
        <div id="chat-container" class="flex-1 overflow-y-auto custom-scrollbar p-4 md:p-8 space-y-6 bg-gray-50/50">
            
            <!-- Welcome Banner -->
            <div class="max-w-3xl mx-auto text-center py-10">
                <div class="w-20 h-20 bg-white rounded-full shadow-lg mx-auto flex items-center justify-center mb-6 text-emerald-500 text-3xl border border-emerald-100">
                    <i class="fa-solid fa-robot"></i>
                </div>
                <h2 class="text-2xl md:text-3xl font-bold text-gray-800 mb-3">Hello! I'm your Health Guide.</h2>
                <p class="text-gray-600 max-w-lg mx-auto">
                    I can create workout plans, suggest recipes, or explain health concepts. 
                    <br><span class="text-sm text-gray-400 italic mt-2 block">(Remember, I am an AI, not a doctor. Consult a professional for medical issues.)</span>
                </p>
            </div>

        </div>

        <!-- Input Area -->
        <div class="bg-white border-t border-gray-200 p-4 md:p-6">
            <div class="max-w-3xl mx-auto">
                <form onsubmit="handleSend(event)" class="relative shadow-lg rounded-xl">
                    <input 
                        type="text" 
                        id="user-input" 
                        class="w-full pl-6 pr-14 py-4 bg-white rounded-xl border border-gray-200 focus:outline-none focus:border-emerald-500 focus:ring-2 focus:ring-emerald-100 transition-all text-gray-700 placeholder-gray-400"
                        placeholder="Ask about your health goals..."
                        autocomplete="off"
                    >
                    <button 
                        type="submit" 
                        class="absolute right-2 top-1/2 -translate-y-1/2 p-2.5 bg-emerald-600 text-white rounded-lg hover:bg-emerald-700 transition-colors shadow-md"
                    >
                        <i class="fa-solid fa-paper-plane"></i>
                    </button>
                </form>
                <p class="text-center text-xs text-gray-400 mt-3">
                    AI can make mistakes. Please verify important information.
                </p>
            </div>
        </div>

    </main>

    <script>
        // =========================================================
        // 1. API CONFIGURATION
        // =========================================================
        
        // Your API Key is pre-filled here
        let apiKey = "AIzaSyDqErBiy3zKlXAYG3siH-TXBP3D70DXBOo"; 
        
        // Environment check for preview tools
        if (!apiKey && typeof window !== 'undefined' && window.apiKey) apiKey = window.apiKey;
        
        const MODEL_NAME = "gemini-2.5-flash-preview-09-2025";

        // =========================================================
        // 2. LOGIC
        // =========================================================

        const chatContainer = document.getElementById('chat-container');
        const userInput = document.getElementById('user-input');

        function sendQuickAction(text) {
            userInput.value = text;
            handleSend(new Event('submit'));
        }

        async function handleSend(e) {
            e.preventDefault();
            const text = userInput.value.trim();
            if (!text) return;

            userInput.value = '';

            // 1. Add User Message
            appendMessage('user', text);

            // 2. Show Loading
            const loadingId = appendLoading();

            try {
                // 3. Call API
                const response = await callGemini(text);
                removeLoading(loadingId);
                appendMessage('ai', response);
            } catch (err) {
                removeLoading(loadingId);
                console.error(err);
                appendMessage('system', 'Error connecting to AI. Please check your connection or API key.');
            }
        }

        // =========================================================
        // 3. GEMINI API CALL
        // =========================================================

        async function callGemini(prompt) {
            if (!apiKey) throw new Error("API Key missing");

            const url = `https://generativelanguage.googleapis.com/v1beta/models/${MODEL_NAME}:generateContent?key=${apiKey}`;
            
            const systemPrompt = `
                You are a professional Health Guide AI. 
                Role: Nutritionist, Fitness Coach, and Wellness Expert.
                Tone: Encouraging, scientific but accessible, concise.
                Formatting: Use Markdown. Use bolding for key terms. Use bullet points for lists.
                
                SAFETY RULES:
                1. You are NOT a doctor. Do not diagnose diseases.
                2. If a user describes symptoms of a heart attack, stroke, severe pain, or mental health crisis, IMMEDIATELY tell them to seek professional medical help or call emergency services.
                3. Keep advice general (e.g., "Eating more protein often helps muscle repair" vs "You specifically need 150g of protein").
            `;

            const response = await fetch(url, {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({
                    contents: [{ parts: [{ text: prompt }] }],
                    systemInstruction: { parts: [{ text: systemPrompt }] }
                })
            });

            if (!response.ok) throw new Error(`API Error: ${response.status}`);
            const data = await response.json();
            return data.candidates[0].content.parts[0].text;
        }

        // =========================================================
        // 4. UI HELPERS
        // =========================================================

        function appendMessage(role, text) {
            const div = document.createElement('div');
            div.className = `max-w-3xl mx-auto w-full flex gap-4 message-enter ${role === 'user' ? 'flex-row-reverse' : ''}`;
            
            let iconHtml = '';
            let bubbleClass = '';

            if (role === 'ai') {
                iconHtml = `
                    <div class="w-10 h-10 rounded-full bg-emerald-100 flex items-center justify-center text-emerald-600 shrink-0 border border-emerald-200">
                        <i class="fa-solid fa-robot"></i>
                    </div>
                `;
                bubbleClass = 'bg-white text-gray-800 border border-gray-200';
            } else if (role === 'user') {
                iconHtml = `
                    <div class="w-10 h-10 rounded-full bg-emerald-600 flex items-center justify-center text-white shrink-0 shadow-md">
                        <i class="fa-solid fa-user"></i>
                    </div>
                `;
                bubbleClass = 'bg-emerald-600 text-white shadow-md';
            } else {
                // System message
                div.innerHTML = `<div class="w-full text-center py-2 text-red-500 bg-red-50 rounded border border-red-100">${text}</div>`;
                chatContainer.appendChild(div);
                scrollToBottom();
                return;
            }

            // Process Text (Basic Markdown -> HTML)
            let formattedText = text
                .replace(/\*\*(.*?)\*\*/g, '<strong>$1</strong>') // Bold
                .replace(/\n/g, '<br>'); // Line breaks

            div.innerHTML = `
                ${iconHtml}
                <div class="flex flex-col max-w-[80%]">
                    <span class="text-xs text-gray-400 mb-1 ${role === 'user' ? 'text-right' : 'text-left'}">
                        ${role === 'ai' ? 'Health Guide' : 'You'}
                    </span>
                    <div class="p-4 rounded-2xl text-sm leading-relaxed ${bubbleClass} ${role === 'user' ? 'rounded-tr-none' : 'rounded-tl-none'}">
                        ${formattedText}
                    </div>
                </div>
            `;

            chatContainer.appendChild(div);
            scrollToBottom();
        }

        function appendLoading() {
            const id = 'loading-' + Date.now();
            const div = document.createElement('div');
            div.id = id;
            div.className = 'max-w-3xl mx-auto w-full flex gap-4 message-enter';
            
            div.innerHTML = `
                <div class="w-10 h-10 rounded-full bg-emerald-100 flex items-center justify-center text-emerald-600 shrink-0 border border-emerald-200">
                    <i class="fa-solid fa-robot"></i>
                </div>
                <div class="flex flex-col">
                    <span class="text-xs text-gray-400 mb-1">Health Guide</span>
                    <div class="bg-white border border-gray-200 p-4 rounded-2xl rounded-tl-none flex items-center gap-2 h-12 w-24">
                        <div class="w-2 h-2 bg-gray-400 rounded-full typing-dot"></div>
                        <div class="w-2 h-2 bg-gray-400 rounded-full typing-dot"></div>
                        <div class="w-2 h-2 bg-gray-400 rounded-full typing-dot"></div>
                    </div>
                </div>
            `;
            chatContainer.appendChild(div);
            scrollToBottom();
            return id;
        }

        function removeLoading(id) {
            const el = document.getElementById(id);
            if (el) el.remove();
        }

        function scrollToBottom() {
            chatContainer.scrollTo({
                top: chatContainer.scrollHeight,
                behavior: 'smooth'
            });
        }
    </script>
</body>
</html>